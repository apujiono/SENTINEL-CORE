<!DOCTYPE html>
<html>
<head>
  <title>🌍 Global Threat Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>#map { height: 100vh; }</style>
</head>
<body>
  <div id="map"></div>
  <script>
    const map = L.map('map').setView([20, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // Gaza
    L.marker([31.5, 34.5]).addTo(map)
      .bindPopup("🇵🇸 Gaza — Under Attack")
      .openPopup();

    // Jakarta
    L.marker([-6.2, 106.8]).addTo(map)
      .bindPopup("🇮🇩 Jakarta — Anti-Corruption Ops");

    // Update sightings
    function updateSightings() {
      fetch('/api/sightings').then(r => r.json()).then(sightings => {
        map.eachLayer(l => { if (l.options?.sentinel) map.removeLayer(l); });
        sightings.forEach(s => {
          const lat = parseFloat(s.lat) || (Math.random() * 2 + 31.4);
          const lng = parseFloat(s.lng) || (Math.random() * 2 + 34.4);
          const marker = L.marker([lat, lng], {
            icon: L.divIcon({ className: 'custom', html: '🔴', sentinel: true })
          }).addTo(map);
          marker.bindPopup(`<b>📍 ${s.target}</b><br>${s.location}`);
        });
      });
    }

    setInterval(updateSightings, 30000);
    updateSightings();
  </script>
</body>
</html>